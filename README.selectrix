Autor: Gerard van der Sel, et al 
Datum: Mai 2005 
Version: SRCP 2.0.8 (pre version) , Selectrix 1.0.0
Lizenz: GPL v2 f�r das gesamte Packet 

Purpose:
In this document the differences between a Marklin/Intellibox and Selectrix are explained and the consequnces for the SRCP implementation of the selectrix protocol (SX_bus only).
In the sources selectrix.c and selectrix.h is a translation module programmed that the bit command normal with Marklin and Intellibox translates to a byte transport. Different element are treated different. But an implementation of the GL, GA and FB commands of SRCP is made.

GL (controlling a enginef) translation:
A GL on SCRP is on a Marklin/Intellibox system the same as on a selectrix system. It is on all systems a multiple bit command.A selectrix decoder accepts the following commnd:
- Bit 4 – bit 0:	Speed of the engine (0 = stop, 31 = max speed)
- Bit 5:			Direction of the engine (0= forward, 1- backward)
- Bit 6:			Licht on/off (0= off, 1= on)
- Bit 7:			Function on/off (0= off, 1= on) 
With the SRCP the command for an engine would be:
SET <busnumber> GL <engineadres> <speed> [[[<direction>] <licht>} <function>}
where:
<busnumber>		Number of de selectrixbus
<engineadres>	Adres of the engine on the SX-bus
<speed>		Speed of the engine
<direction>		Direction of the engine (may be ommitted)
<licht>		State of the negine lights (may be ommitted)
<function> 		State of the engine function (may be ommitted)

GA (controlling switches and signals) translation:
A GA on SCRP is on a Marklin/Intellibox system a one bit instruction. Every switch or signal can be adressed individualy. After a predifined time the switch must be turned off. On the SX-bus (Selectrix) 8 switches are controlled in one action. The switch controller turns the switch command off. 
In de SCRP server the switch turn off command is generated from software. The client doesn't have to turn off the switches. This make the implementation off the switches the following:
SET <busnumber> GA <switchcontroller> <switchdirection> where:
<busnumber>			Number of de selectrixbus
<switchcontroller>	Adres of switch controller on the SX-bus
<switchdirection>	Number from 1 to 16 giving the number of the connected switch and the direction:
            SX-bus bit:	1, 2, 3, 4, 5,  6,  7,  8:
1, 3, 5, 7, 9,  11, 13, 15: Switch normal.
2, 4, 6, 8, 10, 12, 14, 16: Switch thrown.


FB (Feedback contacts from track) translation:
A FB on SCRPis on a Marklin/Intellibox system a bitstream (packeds of 16 bits), which is read from the controller with a byte instruction. This is in SCRP converted to a one bit instruction. On a Selectrix system it is also a byte which is located on the SX-bus. A 'bitstream' of 8 bits is read from the SX-bus. An other 'bitstream' is red from the SX-bus at a different adres.
In the SRCP serverall FB contacts are translated to single contacts. They are located in a big row. To let the Selectrix implementation make such a stream there has to be a further initialization to be done. The SX-bus adresses of the feedback contacts has to be given to the SCRP server. This is done by the command SET <busnumber> FB <numberfeedback> <adresfeedback>.
<numberfeedback> most go from 1 to 112. There may be no gaps between the numbers. After that de feedbacks are checked by:
INFO <busnumber> FB <feedbacknumber>  or GET <busnumber> FB <feedbacknumber>.

Implementation:
In the SRCP server the SX-bus is in an array in the structure Selectrix data. Every action with the SX-bus is done afterreading the other bits of the target adres. The byte send to the SX-bus is also placed in the array, so the array is up to date. This is done inside the IO thread, to make the data in the array thread-save.
In a second array the adresses of the feedback modules are stored.  In a se[erate counter the number of feedback modules is counted.
The thread will in a for the other systems normal way process the data to and from the message queue.