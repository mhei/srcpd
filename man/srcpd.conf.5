.\"
.\" Manual page for srcpd.conf
.\" Process with:
.\"   groff -man -Tlatin1 srcpd.conf.5 | less
.\" or
.\"   groff -man -Tutf8 srcpd.conf.5 | less
.\"
.\" Get a printable version with:
.\"   groff -mandoc -Tps srcpd.conf.5 > srcpd.conf.ps
.\"
.\"
.TH srcpd.conf 5 "December 29, 2007"
.\"

.SH NAME
srcpd.conf \- The configuration file for the srcpd deamon
.\"
.\"
.SH DESCRIPTION
The file \fI/etc/srcpd.conf\fP is used by the \fB srcpd (8)\fP.
This file contains the runtime configuration for the deamon
and it's connection(s) to model railroad system.
See
.BR srcpd\ (8)
for instruction how to use the daemon.
.\"

.SH "DEFAULT CONFIGURATION FILE"

.PP
The default file is shipped as with the srcpd and contains both
default settings and an example bus configuration.

.RS
.nf
<?xml version="1.0"?>
<srcpd version="2.0">
  <bus>
    <server>
      <tcp-port>4303</tcp-port>
      <pid-file>/var/run/srcpd.pid</pid-file>
      <username>nobody</username>
      <groupname>nogroup</groupname>
    </server>
    <verbosity>5</verbosity>
  </bus>
  <bus>
    <loopback>
      <number_fb>3</number_fb>
    </loopback>
    <use_watchdog>no</use_watchdog>
    <verbosity>5</verbosity>
    <auto_power_on>yes</auto_power_on>
  </bus>
</srcpd>
.fi
.RE

.SH "FILE FORMAT"

.PP
The configuration file for srcpd is stored in XML format. As XML
files are plain text, experienced users can manipulate such files with
the help of a text editor. Less experienced users should select an
external configuration tool to ensure a syntactically correct format.
.PP
If there are errors during configuration file reading the daemon will
send appropriate notifications to the syslog daemon. These messages can
be watched using the \fI/var/log/messages\fP file.
.PP
Currently there is no document type definition (DTD) available, to
validate the format of a user created configuration file.
.PP
Each configuration file must contain the following base structure:

.nf
    <?xml version="1.0"?>
    <srcpd>
    ...
    </srcpd>
.fi

.PP
Within this structure (...) the necessary busses are configured, each
using a separate substructure:
.PP
.nf
    <bus>
    ...
    </bus>
    <bus>
    ...
    </bus>
.fi
.\"
.\"
.SS General hints
.PP
The first configured bus should allways be the server-bus. Sequence and
number of the following buses are any desired. Only buses that are
actually used with the daemon should be filed. Not used buses can be
commented out:
.PP
.nf
    <!--
    <bus>
    ...
    </bus>
    -->
.fi

.PP
Please bear in mind the numbering of the following buses will be changed
accordingly.
.\"
.\"
.SS Universal options
.PP
The following options are usable for all used bus sections.
.\"
.TP
verbosity
Depending on this number (valid range: 0..5) the bus will tell you less
or more about what is happening. The 0 value gives a minimum output.
This option is mainly used for debugging reasons. You can watch these
messages using the syslog daemon file \fI/var/log/messages\fP; see
\fBsrcpd\ (8)\fP for more informations.
.\"
.TP
use_watchdog
Some buses provide a watchdog feature to cancel a blocked bus thread.
Valid input values are \fByes\fR or \fBno\fR. The default value is
\fBno\fR.
.\"
.TP
restore_device_settings
Some buses provide a feature to restore serial device settings.
Valid input values are \fByes\fR or \fBno\fR. The default value is
\fBno\fR.
.\"
.TP
device
This is the name of the connected device (like /dev/ttyS0). If bus is
\fBserver\fP or \fBloopback\fP no assignment is necessary. The default
value is \fI/dev/null\fR.
.\"
.TP
auto_power_on
This option enables/disables automatical power on for a bus on server
daemon start.  This option
is not necessary for \fBserver\fP and \fBloopback\fP buses. The default
value is \fBno\fR.
.\"
.TP
speed
Buses using serial devices with a not fixed transfer speed allow to
adjust this parameter. Possible values are 2400, 4800, 9600, 19200,
38400, 57600 and 115200\ baud.
.\"
.\"
.SS server
.PP
This bus is needed everytime. General parameters will be discribed here.
.TP
tcp-port
This is TCP/IP port for communication between srcpd and clients.
Default is 4303 (this port is assigned to SRCP by IANA).
.TP
pid-file
File, where srcpd is storing it's process-id. Default is
\fI/var/run/srcpd.pid\fP.
.TP
username
srcpd runs under this user. Default is \fBnobody\fP.
.TP
groupname
srcpd runs under this group. Default is \fBnogroup\fP.
.\"
.\"
.SS ddl
.PP
Digital Direct for Linux via serial line (RS232).
.TP
number_ga
.TP
number_gl
.TP
enable_ringindicator_checking
.TP
enable_checkshort_checking
.TP
inverse_dsr_handling
.TP
enable_maerklin
.TP
enable_nmradcc
.TP
improve_nmradcc_timing
The default baudrate of DDL is 19200\ baud, which is slightly higher
than allowed by NMRA DCC standard. With a UART 16550A you can change the
baudrate to  16457\ baud, which is within the specification. This is
only needed if you have timing problems with the default.
Valid input values are \fByes\fR or \fBno\fR. The default value is
\fBno\fR, which
corresponds to 19200\ baud.
.TP
shortcut_failure_delay
.TP
nmradcc_translation_routine
There are 3 implementations for converting the logical command bits into
serial line commands, considering the start and stop bits of the serial
line. Valid values are 1, 2 and 3. Default value is 3.
.TP
enable_usleep_patch
.TP
usleep_usec
.TP
nmra_ga_offset
For backward compatibility and alternate usage of different CUs.
If your ga decoders are shifted by 4 (i.e. you want to change switch 1, and
you have to change switch 5 to do this), then you shoul use a value of 1 for
this value. Valid values are 0 and 1. Default value is 0.
.TP
program_track
This parameter allows you to suppress commands which are issued for a
program track. This parameter should only be used on your main.  Valid
input values are \fByes\fR or \fBno\fR. The default value is \fByes\fR,
i.e. all program track commands will be executed by default.
.\"
.\"
.SS ddl-s88
.PP
Digital Direct for Linux S88 via parport (IEEE 1284).
This bus provide 1 up to 4 S88-data links on the parport to connect
S88-feedback modules. The wiring scheme is equivalent to this from the DDL
daemon (http://www.vogt-it.com/OpenSource/DDL) as the circuit of Martin Wolf.
The data links are managed as separate busses. 

The maximum count of modules (with 16 contacts) which can connected to a
data link is 31. When using modules with 8 contacts two modules count as one. 

For each data link a separate bus would be initialized where the order of
the feedback contacts of the modules is increasing so as the order of the
modules connected to the data link. If there are no modules connected to a data
link the respectively value of number_fb_x should be 0. Nevertheless this bus
would be initialized that means also if only one bus is in use all four busses
would be initialized.
.\"
.TP
ioport
Input/Output address of the printer port. The default value is 0x0378 for the
device /dev/lp0. The \fBioport\fR has to give in hexadezimal format (starting
whith 0x). Valid values for a typical linux system are:
.nf

    0x0378  /dev/lp0
    0x0278  /dev/lp1
    0x03BC  /dev/lp2
    
.fi
Is there only one parport avalaible it is typically /dev/lp0. 
.TP
clockscale
Parameter to adjust the clock rate for reading the modules. In the case of the 
default value 35 the original S88 clock rate of approximaly 8\ KHz would be
achieved. Smaller values increasing the clock rate but not each module can work
whith this. In maximum there is approximaly 125\ KHz possible.
.TP
refresh
Delay time in milliseconds after witch the feedback moduls will be read again.
In case of the default value 100 the datas will be refreshed each 100\ ms. 
Useful values are between 1000 and 250.
.TP
fb_delay_time_0
This value in milliseconds determines how long the signal on a feedback contact 
must be on zero level before it accepted as valid and will be forwarded. Whith
this it is in a limited range possible to debounce bad feedback contacts
(bouncing contacts). The default value is 0\ ms.
.TP
number_fb_1
This statement defines the count of to the data link \fB1\fP connected feedback
modules. 
.TP
number_fb_2
This statement defines the count of to the data link \fB2\fP connected feedback
modules. 
.TP
number_fb_3
This statement defines the count of to the data link \fB3\fP connected feedback
modules. 
.TP
number_fb_4
This statement defines the count of to the data link \fB4\fP connected feedback
modules.
.PP
Inside of the configuration the common values should be arranged before
the bus spezific values. A example looks like:

.nf
        <bus>
          <auto_power_on>yes</auto_power_on>
          <verbosity>7</verbosity>
          <device>/dev/lp0</device>
          <ddl-s88>
            <ioport>0x378</ioport>
            <clockscale>35</clockscale>
            <refresh>100</refresh>
            <number_fb_1>3</number_fb_1>
            <number_fb_2>4</number_fb_2>
            <number_fb_3>5</number_fb_3>
            <number_fb_4>6</number_fb_4>
          </ddl-s88>
        </bus>
.fi
.\"
.\"
.SS hsi-88
.PP
This driver supports the HSI-88 device from Littfinski connected
via the serial port. An USB2Serial converter should work fine. The serial
line settings are fixed to 9600\ baud and cannot be changed. Sum of all
feedback-modules must be less or equal to 31, otherwise you will get an
errormessage.
.TP
number_fb_left
HSI-88 has three lines for S88-bus. This value is number of feedback-modules
(with 16 inputs) connected to line called left. If you use feedback-modules
with 8 inputs, 2 modules are counted as one.
.TP
number_fb_center
HSI-88 has three lines for S88-bus. This value is number of feedback-modules
(with 16 inputs) connected to line called center. If you use feedback-modules
with 8 inputs, 2 modules are counted as one.
.TP
number_fb_right
HSI-88 has three lines for S88-bus. This value is number of feedback-modules
(with 16 inputs) connected to line called right. If you use feedback-modules
with 8 inputs, 2 modules are counted as one.
.TP
fb_delay_time_0
This is the time an feedback input must be zero, before zero is delivered to
clients. Time is milliseconds. With this feature you can compensate bad
feedback in a specific range. The default value is 0\ ms.
.TP
refresh
The time in microseconds (us) after srcpd will read feedback from
HSI-88. The default value is 10000\ us.
.\"
.\"
.SS i2c-dev
.PP
Bus driver for i2c-dev interface of the Linux kernel, can be used to
access hardware found on http://www.matronix.de/.
.TP
multiplex_buses
.TP
ga_hardware_inverters
.TP
ga_reset_device
.\"
.\"
.SS intellibox
.PP
This driver supports the Intellibox device from Uhlenbrock connected
via the serial port. Only extended mode commands are used. Programming
decoders is currently implemented for DCC only. Possible values for speed
of serial port are 2400\ baud, 4800\ baud, 9600\ baud, 19200\ baud and
38400\ baud.
.TP
fb_delay_time_0
This is the time in milliseconds a feedback input must be zero, before
this value is delivered to clients. With this feature you can compensate
bad feedback in a specific range. The default value is 0\ ms.
.TP
pause_between_commands
This is the time in milliseconds between two commands the driver must
wait. The exact value should be hand tuned. If the system does not
respond or drops commands try to increase this value. Default is 250\ ms.
.TP
number_ga
This is the maximal address number of Generic Accessory decoders (GA).
Supported range is 0..1024. A value of 0 means no GA available. Default
is 256.
.TP
number_gl
Like the number of GA this number limits the maximum address of the
Generic Locomotive decoders (GL). Supported range
is 0..10239. A value of 0 means no GL available. Default is 80.
.TP
number_fb
This is the number of S88 modules attached to the Intellibox device.
The maximum valid number is 31. The default is 0 (no modules are attached).
Please note that Loconet is currently not supported.
.TP
auto_speed_detection
This option activates an automatical baudrate detection of the connected
Intellibox (BABI = Break and Automatic Baud-rate Identification).  This
procedure takes several seconds but if enabled it is not necessary to
specify a value for the 
.IR speed
parameter.  If disabled the connection initialization is much faster but
the given
.IR speed
value must comply to the actual Intellibox setting.  Valid values are
.IR yes
and
.IR no .
The default value is
.IR yes .
.\"
.\"
.SS li100, li100usb
.PP
This driver connects with the LI100, LI100F, LI101F or LI-USB devices from
Lenz connected via the serial port/USB-interface. An USB2Serial converter
should not be used. The serial line settings are depending on type of
interface. For LI-USB it's fixed to 57600\ baud with no chance to change.
Autodetection of serial port interface speed is currently under
construction. If connection fails, try restart of srcpd with an other
speed. Possible values are 9600\ baud, 19200\ baud, 38400\ baud,
57600\ baud and 115200\ baud, depending on your interface.
.TP
fb_delay_time_0
This is the time in milliseconds an feedback input must be zero, before
this value is delivered to clients. With this feature you can compensate
bad feedback in a specific range. The default value is 0\ ms.
.TP
number_ga
This is the number of GA. Supported range is 0..1024. A value of 0 means no
GA available. Default is 99 (LI-USB 9999).
.TP
number_gl
Like the number of GA this number gives the maximum address. Supported range
is 0..9999. A value of 0 means no GL available. Default is 99 (LI-USB 9999).
.TP
number_fb
This is the number of RS modules attached to the Lenz device.
It can be as large as 512. It's assumed, that one modul has 8 inputs.
A value of 0 means no FB available. Default is 256 (LI-USB 512).
.\"
.\"
.SS Lenz USB Interfaces
.PP
It is very important that you have kernel modul ftdi_sio available.
Due to concept of Lenz, there you get different return values after start.
.TP
.BI 0
everything is OK
.TP
.BI -1
Central Unit not found. Unable to read version of central unit.
.TP
.BI -2
Central Unit not found. Unable to read version of central unit.
.TP
.BI -3
Interface not found. Unable to read version of interface.
This can also happen, if no central unit is connected to interface.
.TP
.BI -4
device not found
.\"

.SS loconet
.PP
This bus provides a driver for the Loconet system by Digitrax.
The device settings may be either serial connections (/dev/ttyS0)
or network links to a lbserver (look at loconetovertcp.sourceforge.net 
for details). An example entry is

.nf 
    <device type="network" port="1234">127.0.0.1</device>
.fi

.TP
loconetID
Default is 0x50.
.TP
ms100
Valid values are
.IR yes
and
.IR no .
Default is
.IR no .

.\"

.SS loopback
.PP
This bus does not connect to real hardware. It is used primarily
for development tasks but may be useful for real installations too.
Every command on this bus does only have an echo effect on the INFO
sessions. This device may be used as virtual device for communication
tasks.
.TP
number_ga
This is the maximal address number of Generic Accessory (GA) devices.
Default is 256.
.TP
number_gl
This number gives the maximum valid address number of the Generic
Locomotive (GL) devices. Default is 80
.TP
number_fb
This is the number of feedback devices. Default is 0 (no device).
.\"
.\"
.SS m605x
.PP
This supports communication with the 6051 or 6050 devices from Maerklin
connected via the serial port. An USB2Serial converter should work
fine. The serial line settings are fixed to 2400\ baud 8N2 and cannot
be changed.
.TP
m6020mode
In this mode the srcpd does not sent the 4 functions. This
is a feature of the 6021 only.
.TP
fb_delay_time_0
This is the time the driver code waits until it recognized the input
change in milliseconds. This feature may support a debounce found in
the hardware. The default value is 0\ ms.
.TP
ga_min_activetime
The time in milliseconds a GA device needs to be in active state. The
absolute minimum is 75\ ms and is needed for stable communication with
the 6051. The default value is 75\ ms.
.TP
pause_between_commands
This is the time between two commands the drivers must wait. The exact
values should be hand tuned. If the system does not respond or drops
commands try to increase this value. Default is 200\ ms.
.TP
pause_between_bytes
This is the time the driver waits between 2 bytes in multi-byte commands.
The hardware handshake does not work with all devices so this parameter
was introduced to support it. The default is 2\ ms.
.TP
number_ga
This is the number of GA. This parameter does not have a real effect
since the interface supports the addresses 1..256 only. Keep the
default value 256 untouched.
.TP
number_gl
Like the number of GA this number gives the maximum GL address. Since
this number is limited to 80, keep the default value 80 untouched.
.TP
number_fb
This is the number of 6088 modules attached to the 6051/6050 device.
The valid range is from 0..31. The default value is 0 (no modules are
attached). Please note that 6088 modules attached to other devices
(memory) cannot be accessed.
.\"
.\"
.SS selectrix
.PP
Selectrix CC-2000 and Rautenhaus SLX852.
.TP
number_ga
.TP
number_gl
.TP
number_fb
.TP
controller
.\"
.\"
.SS zimo
.PP
This bus provides support for the old ASCII based Zimo MX1 interface
protocol. The baud rate can not be changed and has an internal preset
of 9600 Baud.
.TP
number_ga
This value sets the maximum number for the GA address range.  For
protocol M (Maerklin/Motorola) the upper limit is 63, for protocol
N (NMRA/DCC) the upper limit is 2044 (according to Lenz-DCC address
scheme).  The Z (Zimo) protocol is not supported yet.  The default
value is 256.
.TP
number_gl
This value sets the maximum number for the GL address range.  The
default value is 80.
.TP
number_fb
Not supported. The default value is 0.
.TP
fb_delay_time_0
Not supported.
.\"

.SH FILES
.I /etc/srcpd.conf
.\"

.SH "SEE ALSO"
.BR srcpd\ (8)
.\"

.SH AUTHORS
This man page was written by
Matthias Trute (mtrute@users.sourceforge.net),
Frank Schimschke (schmischi@users.sourceforge.net) and
Guido Scholz (gscholz@users.sourceforge.net).
