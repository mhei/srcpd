Autor: Matthias Trute, et al
Datum: Winter 2002/2003
Version: 2 ($Id$)
Lizenz: GPL v2 für das gesamte Packet

Zweck des Programms: 
    SRCP Kommandos werden über das Netzwerk entgegengenommen und mit
    am Server angeschlossener Interfaces an die Modellbahn übermittelt 
    und die Rückmeldemodule eingelesen.


SRCP?
    Simple Railroad Command Protocol
    eine Entwicklung aus dem usenet (news:de.rec.modelle.bahn) um Modellbahnen
    mit dem Computer zu steuern. Die Betonung liegt auf dem S ;=)
    Aktuell ist Version 0.8.

Konfiguration

    Der Dämon wird ausschließlich über eine Konfigurationsdatei konfiguriert.
    Diese heißt standardmäßig /etc/srcpd.conf. Es handelt sich um eine Textdatei
    im XML Format, die mit jedem Editor bearbeitet werden kann.
    
    Die Dokumentstruktur basiert auf der Busstruktur des SRCP 0.8.x. Eine DTD ist
    in Arbeit.
    
    Die Datei wird sequentiell ausgewertet. Dies bedeutet, das die Busse
    in der numerisch korrekten Reihenfolge angegeben werden müssen. Zu
    beachten ist, das einige Treiber mehr als nur einen Bus belegen. Dies
    muß in der korrekten Nummerierung beachtet werden. Etwaige Fehler werden
    nicht immer erkannt. Bei Problemen an dieser Stelle bitte immer die
    Konfigurationsdatei _und_ eine verbale Beschreibung der angeschlossenen
    Hardware mitteilen!
    
    Per Default werden einige Parameter vorgegeben. Dies hat den Effekt, das
    nur Änderungen anegeben werden brauchen. Die Defaultwerte werden sich nicht
    "heimlich" ändern.

    Verbosity
    
    Die Verbosity stellt den Umfang der syslog Meldungen ein.
    
    0 keine Meldungen außer Start/Stop
    1 nur Fatale Fehler
    2 zusätzlich Fehler
    3 zusätzlich Warnungen
    4 zusätzlich Informationen
    5 zusätzlich Debugmeldungen
    >5 Hardware nicht immer tatsächlich angesprochen
    
    DDL S88
    
    Dieser Treiber benutzt 4 Busse. Dies wird entsprechend dem Anschlußschema
    des DDL Dämonen (www.vogt-it.com/OpenSource/DDL) übernommen. Die Anschlußstränge
    entsprechend der Schaltung von Martin Wolf werden als separate Busse geführt.
    Auch wenn nur ein Bus angeschlossen ist, werden immer 4 Busse belegt. Der ioport
    sollte im Hexadezimalformat angegeben werden (mit führenden 0x).
    
    Beispiel: ein S88 Modul.
    <bus number="1">
      <ddl-s88>
	<ioport>0x378</ioport>
	<number_fb_1>1</number_fb_1>
	<number_fb_2>0</number_fb_2>
	<number_fb_3>0</number_fb_3>
	<number_fb_4>0</number_fb_4>
      </ddl-s88>
      <device>/dev/lp0</device>
      <use_watchdog>no</use_watchdog>
      <restore_device_settings>no</restore_device_settings>
      <verbosity>7</verbosity>
    </bus>
    
    Ohne die Schaltung von Martin Wolf werden trotzdem 4 Busse belegt,
    auch wenn nur der erste Bus tatsächlich vorhanden ist.
    
    Märklin 6051
    Das Märklin Interface belegt einen Bus, der die Gerätegruppen
    GA, GL, FB, LOCK und POWER unterstützt. Ebenso wird ein Watchdog 
    unterstützt.
    
     <bus number="5">
        <m605x>
	  <number_fb>2</number_fb>
        </m605x>
        <device>/dev/ttyS1</device>
        <use_watchdog>yes</use_watchdog>
        <restore_device_settings>no</restore_device_settings>
        <verbosity>1</verbosity>
      </bus>
    
    
Installieren und Benutzen:

    Installation der rpm Packete ist wie immer bei solchen mit
    "rpm -i <dateiname>.rpm". Dabei werden die erforderlichen
    Links zum Starten des Daemons in /etc/init.d angelegt (aber
    nicht automatisch gestartet). Manuell kann der Daemon dann mit den
    Standardverfahren gestartet und gestoppt werden. Da sich die
    Distributoren leider noch nicht geeinigt haben, funktioniert
    das nur unter aktuellen (7.x, 8.x) SuSE Versionen. 
    
    Das Deinstallieren stoppt einen laufenden Daemon zuerst, bevor
    die Dateien entfernt werden.

    Hardware sollte im eigenen Interesse nur im komplett ausgeschaltetem
    Zustand angeschlossen und entfernt werden.
    
    Mit srcpd -h erhält man eine Übersicht über die möglichen
    Parameter, das sind aber nicht allzuviele. Alle Einstellungen werden
    ausschließlich über die beschriebene Konfigurationsdatei vorgenommen.
    
    Dann einfach das Programm mit "/usr/sbin/rcsrcpd start" starten. 
    Je nach angeschlossener Hardware muß dies ggf. als root erfolgen.
    Auch sind ggf. vorher Kernelmodule zu laden.

    Je nach eingestellter <verbosity> werden mehr oder weniger viele Daten
    in das Systemprotokoll geschrieben. Hierzu wird der syslog Dienst benutzt,
    der die LOG_INFO des srcpd normalerweise nach /var/log/messages schreibt.
    Wird die <verbosity> auf null gesetzt, werden nur gravierende Meldungen
    geschrieben, höherer Werte können, je nach Treiber, zu einem bitgenauem
    Tätigkeitsprotokoll führen.

Bekannte Unzulänglichkeiten
    Das Timing der Datenübermittlung ist kritisch und "handverlesen"

    Die Totzeit bis zum Wirksamwerden eines Befehls kann schon mal
    länger dauern, vor allem wenn viele Befehle für ein Gerät anstehen.

    Beim 6021, das einige Befehle vom 6051 erst beim normalen Refresh 
    einarbeitet, kann es systembedingt einige Sekunden dauern... Ohne, das
    man was daran ändern könnte.

Verwandte Programme:
    siehe http://www.der-moba.de/Digital

Rechtliches: 

    Für die vorliegende Software wird keine Haftung übernommen. Aus der
    Tatsache, das es bei den Autoren zu deren Zufriedenheit funktioniert kann niemals 
    geschlußfolgert werden, das es auch bei anderen funktioniert und keinen 
    Schaden anrichtet. Wer dieses Programm benutzt, tut es auf eigene Gefahr. Es gab
    schon irreparable Hardwareschäden! Wenn jemanden dies widerfährt, hat er unser
    Mitgefühl. Mehr aber auch nicht. Wir erstellen die Software nicht gewerblich.
    
Sonst noch was?
    Jede Änderung und jeder Erfahrungsbericht ist a) willkommen und sollte b) irgendwie
    auch bei den Autoren ankommen. Hilfreich sind dann Angaben zur Version (steht im Welcome des
    laufenden Servers).

Weitere Informationen: 
    http://srcpd.sourceforge.net
    http://www.der-moba.de/Digital
    
